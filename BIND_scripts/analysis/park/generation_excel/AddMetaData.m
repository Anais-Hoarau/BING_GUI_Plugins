%Chargement du tripset sur le dossier qui contient tout les sujets
directory = uigetdir(pwd, 'Choisissez le chemin du dossier contenant tout les trips de PARK');
if directory == 0
    return;
end
[metafile,metapath] = uigetfile('*.xls', 'Choisissez le fichier contenant les métadonnées');
if metafile == 0
    return;
end
tripsFolders = {'park01_100607_10h07/trip_park01.trip',...
                'park02_100608_10h02/trip_park02.trip', ...
                'park03_100610_10h03/trip_park03.trip',...
                'park04_100614_10h10/trip_park04.trip',...
                'park05_100615_10h09/trip_park05.trip',...
                'park06_100621_09h59/trip_park06.trip',...
                'park07_100622_10h13/trip_park07.trip',...
                'park08_100624_10h17/trip_park08.trip',...
                'park09_100628_10h23/trip_park09.trip',...
                'park10_100629_10h06/trip_park10.trip',...
                'park11_100701_10h31/trip_park11.trip',...
                'park12_100705_10h04/trip_park12.trip',...
                'park13_100706_10h34/trip_park13.trip',...
                'park14_100708_10h17/trip_park14.trip',...
                'park16_100914_10h02/trip_park16.trip',...
                'park17_101004_10h42/trip_park17.trip',...
                'park18_101011_10h10/trip_park18.trip',...
                'park20_101018_10h08/trip_park20.trip',...
                'park21_101019_10h20/trip_park21.trip',...
                'park22_101025_10h03/trip_park22.trip',...
                'park23_101026_10h18/trip_park23.trip',...
                'park24_101108_10h24/trip_park24.trip',...
                'park25_101109_10h07/trip_park25.trip',...
                'park26_101115_10h20/trip_park26.trip',...
                'park27_101116_10h08/trip_park27.trip',...
                'park28_101118_10h23/trip_park28.trip',...
                'park29_101122_10h16/trip_park29.trip',...
                'park30_101123_10h10/trip_park30.trip',...
                'park31_101125_10h22/trip_park31.trip',...
                'park32_101129_10h49/trip_park32.trip',...
                'park33_101130_10h15/trip_park33.trip',...
                'park34_101206_10h12/trip_park34.trip',...
                'park35_101207_10h11/trip_park35.trip',...
                'park36_110110_10h12/trip_park36.trip',...
                'park38_110411_10h06/trip_park38.trip',...
                'park39_110516_10h31/trip_park39.trip',...
                'park40_110517_08h11/trip_park40.trip',...
                };
                %'park19_101012_10h02/trip_park19.trip',...
                %'park15_100913_10h05/trip_park15.trip',...
                %'park37_110228_10h21/trip_park37.trip',...
numberOfTrips = length(tripsFolders);
trips = cell(numberOfTrips);
for i = 1:1:numberOfTrips
    completeBeforePath = [directory filesep strrep(tripsFolders{i}, '.trip', '.before')];
    disp(['Vérification de l''existence de ' completeBeforePath]);
    atLeastOneKO = false;
    if exist(completeBeforePath, 'file')
        disp('-- OK');
    else
        disp('-- KO');
        atLeastOneKO = true;
    end
end
if atLeastOneKO
   error('Au moins un des trips n''a pas de fichier .before correspondant'); 
end
    
for i = 1:1:numberOfTrips
    completeFilePath = [directory filesep tripsFolders{i}];
    disp(['Chargement de ' completeFilePath]);
    trips{i} = fr.lescot.bind.kernel.implementation.SQLiteTrip(completeFilePath, 0.1, false);
end
disp([num2str(numberOfTrips) ' trips chargés']);

%Lecture des Métadonnées
[~, ~, xlsContent] = xlsread([metapath filesep metafile]);

for i = 1:1:numberOfTrips;
    trip = trips{i};
    disp(['Récupération & modification des métadonnées du sujet ' num2str(i)]);
    participant = trip.getMetaInformations().getParticipant();

    driver = num2str(xlsContent{i, 1});
    disp(['-- Driver : ' driver]); 
    participant.setAttribute('Driver', driver);
    
    numberStatus = xlsContent{i, 2};
    disp(['-- Number status : ' numberStatus]); 
    participant.setAttribute('Number_status', numberStatus);
    
    status = num2str(xlsContent{i, 3});
    disp(['-- Status : ' status]); 
    participant.setAttribute('Status', status);

    trip.setParticipant(participant);
end